- name: Install Android SDK + NDK 23 (FORCE)
      run: |
        export ANDROID_SDK_ROOT=$HOME/.buildozer/android/platform/android-sdk
        mkdir -p $ANDROID_SDK_ROOT
        mkdir -p ~/.android
        echo "count=0" > ~/.android/repositories.cfg

        # cmdline-tools
        curl -o cmdline-tools.zip https://dl.google.com/android/repository/commandlinetools-linux-9477386_latest.zip
        unzip -q cmdline-tools.zip
        mkdir -p $ANDROID_SDK_ROOT/cmdline-tools/latest
        mv cmdline-tools/* $ANDROID_SDK_ROOT/cmdline-tools/latest/

        # legacy sdkmanager path (buildozer fix)
        mkdir -p $ANDROID_SDK_ROOT/tools/bin
        ln -sf $ANDROID_SDK_ROOT/cmdline-tools/latest/bin/sdkmanager \
               $ANDROID_SDK_ROOT/tools/bin/sdkmanager

        export PATH=$ANDROID_SDK_ROOT/cmdline-tools/latest/bin:$PATH

        yes | sdkmanager --licenses

        # ⚠️ تثبيت محدد فقط
        sdkmanager \
          "platform-tools" \
          "platforms;android-31" \
          "build-tools;30.0.3" \
          "ndk;23.1.7779620"

        # ❌ حذف أي NDK آخر (مهم جدًا)
        rm -rf $ANDROID_SDK_ROOT/ndk/* || true
        ln -s $ANDROID_SDK_ROOT/ndk/23.1.7779620 $ANDROID_SDK_ROOT/ndk-bundle
